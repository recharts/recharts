import { describe, it, expect } from 'vitest';
import { SymbolFlags } from 'ts-morph';
import { ProjectDocReader } from './readProject';

describe('readProject', () => {
  const reader = new ProjectDocReader();
  it('should identify all exported symbols', () => {
    /*
     * Let's assert a few known symbols to make sure the reader is working.
     * We don't need to list them all here, that just makes a brittle test
     */
    const expectedComponents = ['Area', 'AreaProps', 'Bar', 'BarProps'];
    expect(reader.getPublicSymbolNames()).toEqual(expect.arrayContaining(expectedComponents));
  });

  it('should identify all components', () => {
    const expectedComponents = ['Area', 'Bar', 'LineChart', 'ResponsiveContainer'];
    const unexpectedSymbols = ['useChartWidth', 'getNiceTickValues', 'Symbol', 'AreaProps', 'BarProps'];
    expect(reader.getPublicComponentNames()).toEqual(expect.arrayContaining(expectedComponents));
    unexpectedSymbols.forEach(unexpectedSymbol => {
      expect(reader.getPublicComponentNames()).not.toContain(unexpectedSymbol);
    });
  });

  it('should filter symbols by kind', () => {
    // this is a list of exported runtime objects, looks useful. Where is ZAxis though? Maybe ZAxis is a function.
    expect(reader.getPublicSymbolNames(SymbolFlags.Variable)).toMatchInlineSnapshot(`
      [
        "Area",
        "AreaChart",
        "Bar",
        "BarChart",
        "CartesianAxis",
        "Cell",
        "ComposedChart",
        "Cross",
        "Curve",
        "DefaultLegendContent",
        "DefaultTooltipContent",
        "DefaultZIndexes",
        "Dot",
        "FunnelChart",
        "getNiceTickValues",
        "Global",
        "Layer",
        "Line",
        "LineChart",
        "PieChart",
        "PolarGrid",
        "Polygon",
        "RadarChart",
        "RadialBarChart",
        "Rectangle",
        "ResponsiveContainer",
        "Scatter",
        "ScatterChart",
        "Sector",
        "SunburstChart",
        "Surface",
        "Symbols",
        "Text",
        "Trapezoid",
        "useActiveTooltipDataPoints",
        "useActiveTooltipLabel",
        "useChartHeight",
        "useChartWidth",
        "useMargin",
        "useOffset",
        "usePlotArea",
        "useXAxisDomain",
        "useYAxisDomain",
        "XAxis",
        "YAxis",
      ]
    `);
  });

  it('should return properties', () => {
    // this is not entirely helpful for what we need to do
    expect(reader.getPropertiesOf('Funnel')).toMatchInlineSnapshot(`
      [
        "render",
        "context",
        "setState",
        "forceUpdate",
        "props",
        "state",
        "refs",
        "componentDidMount",
        "shouldComponentUpdate",
        "componentWillUnmount",
        "componentDidCatch",
        "getSnapshotBeforeUpdate",
        "componentDidUpdate",
        "componentWillMount",
        "UNSAFE_componentWillMount",
        "componentWillReceiveProps",
        "UNSAFE_componentWillReceiveProps",
        "componentWillUpdate",
        "UNSAFE_componentWillUpdate",
      ]
    `);
  });

  it('should return Recharts props of Bar', () => {
    expect(reader.getRechartsPropsOf('Bar')).toMatchInlineSnapshot(`
      [
        "activeBar",
        "animationBegin",
        "animationDuration",
        "animationEasing",
        "background",
        "barSize",
        "children",
        "className",
        "dangerouslySetInnerHTML",
        "dataKey",
        "hide",
        "id",
        "index",
        "isAnimationActive",
        "label",
        "legendType",
        "maxBarSize",
        "minPointSize",
        "name",
        "onAbort",
        "onAbortCapture",
        "onAnimationEnd",
        "onAnimationEndCapture",
        "onAnimationIteration",
        "onAnimationIterationCapture",
        "onAnimationStart",
        "onAnimationStartCapture",
        "onAuxClick",
        "onAuxClickCapture",
        "onBeforeInput",
        "onBeforeInputCapture",
        "onBlur",
        "onBlurCapture",
        "onCanPlay",
        "onCanPlayCapture",
        "onCanPlayThrough",
        "onCanPlayThroughCapture",
        "onChange",
        "onChangeCapture",
        "onClick",
        "onClickCapture",
        "onCompositionEnd",
        "onCompositionEndCapture",
        "onCompositionStart",
        "onCompositionStartCapture",
        "onCompositionUpdate",
        "onCompositionUpdateCapture",
        "onContextMenu",
        "onContextMenuCapture",
        "onCopy",
        "onCopyCapture",
        "onCut",
        "onCutCapture",
        "onDoubleClick",
        "onDoubleClickCapture",
        "onDrag",
        "onDragCapture",
        "onDragEnd",
        "onDragEndCapture",
        "onDragEnter",
        "onDragEnterCapture",
        "onDragExit",
        "onDragExitCapture",
        "onDragLeave",
        "onDragLeaveCapture",
        "onDragOver",
        "onDragOverCapture",
        "onDragStart",
        "onDragStartCapture",
        "onDrop",
        "onDropCapture",
        "onDurationChange",
        "onDurationChangeCapture",
        "onEmptied",
        "onEmptiedCapture",
        "onEncrypted",
        "onEncryptedCapture",
        "onEnded",
        "onEndedCapture",
        "onError",
        "onErrorCapture",
        "onFocus",
        "onFocusCapture",
        "onGotPointerCapture",
        "onGotPointerCaptureCapture",
        "onInput",
        "onInputCapture",
        "onInvalid",
        "onInvalidCapture",
        "onKeyDown",
        "onKeyDownCapture",
        "onKeyPress",
        "onKeyPressCapture",
        "onKeyUp",
        "onKeyUpCapture",
        "onLoad",
        "onLoadCapture",
        "onLoadedData",
        "onLoadedDataCapture",
        "onLoadedMetadata",
        "onLoadedMetadataCapture",
        "onLoadStart",
        "onLoadStartCapture",
        "onLostPointerCapture",
        "onLostPointerCaptureCapture",
        "onMouseDown",
        "onMouseDownCapture",
        "onMouseEnter",
        "onMouseLeave",
        "onMouseMove",
        "onMouseMoveCapture",
        "onMouseOut",
        "onMouseOutCapture",
        "onMouseOver",
        "onMouseOverCapture",
        "onMouseUp",
        "onMouseUpCapture",
        "onPaste",
        "onPasteCapture",
        "onPause",
        "onPauseCapture",
        "onPlay",
        "onPlayCapture",
        "onPlaying",
        "onPlayingCapture",
        "onPointerCancel",
        "onPointerCancelCapture",
        "onPointerDown",
        "onPointerDownCapture",
        "onPointerEnter",
        "onPointerEnterCapture",
        "onPointerLeave",
        "onPointerLeaveCapture",
        "onPointerMove",
        "onPointerMoveCapture",
        "onPointerOut",
        "onPointerOutCapture",
        "onPointerOver",
        "onPointerOverCapture",
        "onPointerUp",
        "onPointerUpCapture",
        "onProgress",
        "onProgressCapture",
        "onRateChange",
        "onRateChangeCapture",
        "onReset",
        "onResetCapture",
        "onScroll",
        "onScrollCapture",
        "onSeeked",
        "onSeekedCapture",
        "onSeeking",
        "onSeekingCapture",
        "onSelect",
        "onSelectCapture",
        "onStalled",
        "onStalledCapture",
        "onSubmit",
        "onSubmitCapture",
        "onSuspend",
        "onSuspendCapture",
        "onTimeUpdate",
        "onTimeUpdateCapture",
        "onTouchCancel",
        "onTouchCancelCapture",
        "onTouchEnd",
        "onTouchEndCapture",
        "onTouchMove",
        "onTouchMoveCapture",
        "onTouchStart",
        "onTouchStartCapture",
        "onTransitionEnd",
        "onTransitionEndCapture",
        "onVolumeChange",
        "onVolumeChangeCapture",
        "onWaiting",
        "onWaitingCapture",
        "onWheel",
        "onWheelCapture",
        "radius",
        "shape",
        "stackId",
        "tooltipType",
        "unit",
        "xAxisId",
        "yAxisId",
        "zIndex",
      ]
    `);
  });

  it('should return all props of Bar including SVG', () => {
    expect(reader.getAllPropsOf('Bar')).toMatchInlineSnapshot(`
      [
        "accentHeight",
        "accumulate",
        "activeBar",
        "additive",
        "alignmentBaseline",
        "allowReorder",
        "alphabetic",
        "amplitude",
        "animationBegin",
        "animationDuration",
        "animationEasing",
        "arabicForm",
        "aria-activedescendant",
        "aria-atomic",
        "aria-autocomplete",
        "aria-braillelabel",
        "aria-brailleroledescription",
        "aria-busy",
        "aria-checked",
        "aria-colcount",
        "aria-colindex",
        "aria-colindextext",
        "aria-colspan",
        "aria-controls",
        "aria-current",
        "aria-describedby",
        "aria-description",
        "aria-details",
        "aria-disabled",
        "aria-dropeffect",
        "aria-errormessage",
        "aria-expanded",
        "aria-flowto",
        "aria-grabbed",
        "aria-haspopup",
        "aria-hidden",
        "aria-invalid",
        "aria-keyshortcuts",
        "aria-label",
        "aria-labelledby",
        "aria-level",
        "aria-live",
        "aria-modal",
        "aria-multiline",
        "aria-multiselectable",
        "aria-orientation",
        "aria-owns",
        "aria-placeholder",
        "aria-posinset",
        "aria-pressed",
        "aria-readonly",
        "aria-relevant",
        "aria-required",
        "aria-roledescription",
        "aria-rowcount",
        "aria-rowindex",
        "aria-rowindextext",
        "aria-rowspan",
        "aria-selected",
        "aria-setsize",
        "aria-sort",
        "aria-valuemax",
        "aria-valuemin",
        "aria-valuenow",
        "aria-valuetext",
        "ascent",
        "attributeName",
        "attributeType",
        "autoReverse",
        "azimuth",
        "background",
        "barSize",
        "baseFrequency",
        "baselineShift",
        "baseProfile",
        "bbox",
        "begin",
        "bias",
        "by",
        "calcMode",
        "capHeight",
        "children",
        "className",
        "clip",
        "clipPath",
        "clipPathUnits",
        "clipRule",
        "color",
        "colorInterpolation",
        "colorInterpolationFilters",
        "colorProfile",
        "colorRendering",
        "contentScriptType",
        "contentStyleType",
        "crossOrigin",
        "cursor",
        "cx",
        "cy",
        "d",
        "dangerouslySetInnerHTML",
        "dataKey",
        "decelerate",
        "descent",
        "diffuseConstant",
        "direction",
        "display",
        "divisor",
        "dominantBaseline",
        "dur",
        "dx",
        "dy",
        "edgeMode",
        "elevation",
        "enableBackground",
        "end",
        "exponent",
        "externalResourcesRequired",
        "fill",
        "fillOpacity",
        "fillRule",
        "filter",
        "filterRes",
        "filterUnits",
        "floodColor",
        "floodOpacity",
        "focusable",
        "fontFamily",
        "fontSize",
        "fontSizeAdjust",
        "fontStretch",
        "fontStyle",
        "fontVariant",
        "fontWeight",
        "format",
        "fr",
        "from",
        "fx",
        "fy",
        "g1",
        "g2",
        "glyphName",
        "glyphOrientationHorizontal",
        "glyphOrientationVertical",
        "glyphRef",
        "gradientTransform",
        "gradientUnits",
        "hanging",
        "height",
        "hide",
        "horizAdvX",
        "horizOriginX",
        "href",
        "id",
        "ideographic",
        "imageRendering",
        "in",
        "in2",
        "index",
        "intercept",
        "isAnimationActive",
        "k",
        "k1",
        "k2",
        "k3",
        "k4",
        "kernelMatrix",
        "kernelUnitLength",
        "kerning",
        "key",
        "keyPoints",
        "keySplines",
        "keyTimes",
        "label",
        "lang",
        "legendType",
        "lengthAdjust",
        "letterSpacing",
        "lightingColor",
        "limitingConeAngle",
        "local",
        "markerEnd",
        "markerHeight",
        "markerMid",
        "markerStart",
        "markerUnits",
        "markerWidth",
        "mask",
        "maskContentUnits",
        "maskUnits",
        "mathematical",
        "max",
        "maxBarSize",
        "media",
        "method",
        "min",
        "minPointSize",
        "mode",
        "name",
        "numOctaves",
        "offset",
        "onAbort",
        "onAbortCapture",
        "onAnimationEnd",
        "onAnimationEndCapture",
        "onAnimationIteration",
        "onAnimationIterationCapture",
        "onAnimationStart",
        "onAnimationStartCapture",
        "onAuxClick",
        "onAuxClickCapture",
        "onBeforeInput",
        "onBeforeInputCapture",
        "onBlur",
        "onBlurCapture",
        "onCanPlay",
        "onCanPlayCapture",
        "onCanPlayThrough",
        "onCanPlayThroughCapture",
        "onChange",
        "onChangeCapture",
        "onClick",
        "onClickCapture",
        "onCompositionEnd",
        "onCompositionEndCapture",
        "onCompositionStart",
        "onCompositionStartCapture",
        "onCompositionUpdate",
        "onCompositionUpdateCapture",
        "onContextMenu",
        "onContextMenuCapture",
        "onCopy",
        "onCopyCapture",
        "onCut",
        "onCutCapture",
        "onDoubleClick",
        "onDoubleClickCapture",
        "onDrag",
        "onDragCapture",
        "onDragEnd",
        "onDragEndCapture",
        "onDragEnter",
        "onDragEnterCapture",
        "onDragExit",
        "onDragExitCapture",
        "onDragLeave",
        "onDragLeaveCapture",
        "onDragOver",
        "onDragOverCapture",
        "onDragStart",
        "onDragStartCapture",
        "onDrop",
        "onDropCapture",
        "onDurationChange",
        "onDurationChangeCapture",
        "onEmptied",
        "onEmptiedCapture",
        "onEncrypted",
        "onEncryptedCapture",
        "onEnded",
        "onEndedCapture",
        "onError",
        "onErrorCapture",
        "onFocus",
        "onFocusCapture",
        "onGotPointerCapture",
        "onGotPointerCaptureCapture",
        "onInput",
        "onInputCapture",
        "onInvalid",
        "onInvalidCapture",
        "onKeyDown",
        "onKeyDownCapture",
        "onKeyPress",
        "onKeyPressCapture",
        "onKeyUp",
        "onKeyUpCapture",
        "onLoad",
        "onLoadCapture",
        "onLoadedData",
        "onLoadedDataCapture",
        "onLoadedMetadata",
        "onLoadedMetadataCapture",
        "onLoadStart",
        "onLoadStartCapture",
        "onLostPointerCapture",
        "onLostPointerCaptureCapture",
        "onMouseDown",
        "onMouseDownCapture",
        "onMouseEnter",
        "onMouseLeave",
        "onMouseMove",
        "onMouseMoveCapture",
        "onMouseOut",
        "onMouseOutCapture",
        "onMouseOver",
        "onMouseOverCapture",
        "onMouseUp",
        "onMouseUpCapture",
        "onPaste",
        "onPasteCapture",
        "onPause",
        "onPauseCapture",
        "onPlay",
        "onPlayCapture",
        "onPlaying",
        "onPlayingCapture",
        "onPointerCancel",
        "onPointerCancelCapture",
        "onPointerDown",
        "onPointerDownCapture",
        "onPointerEnter",
        "onPointerEnterCapture",
        "onPointerLeave",
        "onPointerLeaveCapture",
        "onPointerMove",
        "onPointerMoveCapture",
        "onPointerOut",
        "onPointerOutCapture",
        "onPointerOver",
        "onPointerOverCapture",
        "onPointerUp",
        "onPointerUpCapture",
        "onProgress",
        "onProgressCapture",
        "onRateChange",
        "onRateChangeCapture",
        "onReset",
        "onResetCapture",
        "onResize",
        "onResizeCapture",
        "onScroll",
        "onScrollCapture",
        "onSeeked",
        "onSeekedCapture",
        "onSeeking",
        "onSeekingCapture",
        "onSelect",
        "onSelectCapture",
        "onStalled",
        "onStalledCapture",
        "onSubmit",
        "onSubmitCapture",
        "onSuspend",
        "onSuspendCapture",
        "onTimeUpdate",
        "onTimeUpdateCapture",
        "onTouchCancel",
        "onTouchCancelCapture",
        "onTouchEnd",
        "onTouchEndCapture",
        "onTouchMove",
        "onTouchMoveCapture",
        "onTouchStart",
        "onTouchStartCapture",
        "onTransitionEnd",
        "onTransitionEndCapture",
        "onVolumeChange",
        "onVolumeChangeCapture",
        "onWaiting",
        "onWaitingCapture",
        "onWheel",
        "onWheelCapture",
        "opacity",
        "operator",
        "order",
        "orient",
        "orientation",
        "origin",
        "overflow",
        "overlinePosition",
        "overlineThickness",
        "paintOrder",
        "panose1",
        "path",
        "pathLength",
        "patternContentUnits",
        "patternTransform",
        "patternUnits",
        "pointerEvents",
        "points",
        "pointsAtX",
        "pointsAtY",
        "pointsAtZ",
        "preserveAlpha",
        "preserveAspectRatio",
        "primitiveUnits",
        "r",
        "radius",
        "refX",
        "refY",
        "renderingIntent",
        "repeatCount",
        "repeatDur",
        "requiredExtensions",
        "requiredFeatures",
        "restart",
        "result",
        "role",
        "rotate",
        "rx",
        "ry",
        "scale",
        "seed",
        "shape",
        "shapeRendering",
        "slope",
        "spacing",
        "specularConstant",
        "specularExponent",
        "speed",
        "spreadMethod",
        "stackId",
        "startOffset",
        "stdDeviation",
        "stemh",
        "stemv",
        "stitchTiles",
        "stopColor",
        "stopOpacity",
        "strikethroughPosition",
        "strikethroughThickness",
        "string",
        "stroke",
        "strokeDasharray",
        "strokeDashoffset",
        "strokeLinecap",
        "strokeLinejoin",
        "strokeMiterlimit",
        "strokeOpacity",
        "strokeWidth",
        "style",
        "suppressHydrationWarning",
        "surfaceScale",
        "systemLanguage",
        "tabIndex",
        "tableValues",
        "target",
        "targetX",
        "targetY",
        "textAnchor",
        "textDecoration",
        "textLength",
        "textRendering",
        "to",
        "tooltipType",
        "transform",
        "type",
        "u1",
        "u2",
        "underlinePosition",
        "underlineThickness",
        "unicode",
        "unicodeBidi",
        "unicodeRange",
        "unit",
        "unitsPerEm",
        "vAlphabetic",
        "values",
        "vectorEffect",
        "version",
        "vertAdvY",
        "vertOriginX",
        "vertOriginY",
        "vHanging",
        "vIdeographic",
        "viewBox",
        "viewTarget",
        "visibility",
        "vMathematical",
        "width",
        "widths",
        "wordSpacing",
        "writingMode",
        "x",
        "x1",
        "x2",
        "xAxisId",
        "xChannelSelector",
        "xHeight",
        "xlinkActuate",
        "xlinkArcrole",
        "xlinkHref",
        "xlinkRole",
        "xlinkShow",
        "xlinkTitle",
        "xlinkType",
        "xmlBase",
        "xmlLang",
        "xmlns",
        "xmlnsXlink",
        "xmlSpace",
        "y",
        "y1",
        "y2",
        "yAxisId",
        "yChannelSelector",
        "z",
        "zIndex",
        "zoomAndPan",
      ]
    `);
  });

  it('should return props of ReferenceLine', () => {
    expect(reader.getRechartsPropsOf('ReferenceLine')).toMatchInlineSnapshot(`
      [
        "className",
        "ifOverflow",
        "label",
        "position",
        "segment",
        "shape",
        "x",
        "xAxisId",
        "y",
        "yAxisId",
        "zIndex",
      ]
    `);
  });

  it('should return prop meta when recharts overwrites DOM prop', () => {
    const propMeta = reader.getPropMeta('ReferenceLine', 'x');
    expect(propMeta).toEqual([
      {
        defaultValueFromJSDoc: { type: 'unreadable' },
        defaultValueFromObject: { type: 'unreadable' },
        name: 'x',
        origin: 'dom',
      },
      {
        defaultValueFromJSDoc: { type: 'unreadable' },
        defaultValueFromObject: { type: 'none' },
        name: 'x',
        origin: 'recharts',
      },
    ]);
  });

  it('should return prop meta where recharts has default value from JSDoc', () => {
    const propMeta = reader.getPropMeta('ReferenceLine', 'position');
    expect(propMeta).toEqual([
      {
        defaultValueFromJSDoc: { type: 'known', value: "'middle'" },
        defaultValueFromObject: { type: 'known', value: 'middle' },
        name: 'position',
        origin: 'recharts',
      },
    ]);
  });

  it('should return SVG component that this component extends', () => {
    expect(reader.getSVGParentOf('ReferenceLine')).toBe('SVGLineElement');
  });

  it('should get default value of a prop', () => {
    expect(reader.getDefaultValueOf('ReferenceLine', 'position')).toEqual({ type: 'known', value: 'middle' });
  });

  it('should get integer default value', () => {
    expect(reader.getDefaultValueOf('Area', 'animationDuration')).toEqual({ type: 'known', value: 1500 });
  });

  it('should return none for default value of a prop without default', () => {
    expect(reader.getDefaultValueOf('AreaChart', 'id')).toEqual({ type: 'none' });
  });
});
